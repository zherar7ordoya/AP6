

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from mvcsharp.org/Reworking_ASPNET_MVC_Store/Default.aspx by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 30 Oct 2008 03:46:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head><title>
	Reworking ASP.NET MVC Store with MVC# Framework
</title><link href="../Styles.css" rel="stylesheet" type="text/css" /></head>
<body>
    <form name="aspnetForm" method="post" action="http://mvcsharp.org/Reworking_ASPNET_MVC_Store/Default.aspx" id="aspnetForm">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTEwMDUyNjYzMjgPZBYCZg9kFgICAw9kFgICCQ88KwAJAgAPFgQeDU5ldmVyRXhwYW5kZWRkHgtfIURhdGFCb3VuZGdkCBQrAAUFDzA6MCwwOjEsMDoyLDA6MxQrAAIWDB4EVGV4dAUNRG9jdW1lbnRhdGlvbh4FVmFsdWUFDURvY3VtZW50YXRpb24eC05hdmlnYXRlVXJsBRMvRG9jdW1lbnRhdGlvbi5hc3B4HghEYXRhUGF0aAUTL2RvY3VtZW50YXRpb24uYXNweB4JRGF0YUJvdW5kZx4IRXhwYW5kZWRnFCsABQUPMDowLDA6MSwwOjIsMDozFCsAAhYKHwIFCE92ZXJ2aWV3HwMFCE92ZXJ2aWV3HwQFFi9PdmVydmlldy9EZWZhdWx0LmFzcHgfBQUWL292ZXJ2aWV3L2RlZmF1bHQuYXNweB8GZ2QUKwACFgwfAgUIRXhhbXBsZXMfAwUIRXhhbXBsZXMfBAUOL0V4YW1wbGVzLmFzcHgfBQUOL2V4YW1wbGVzLmFzcHgfBmcfB2cUKwAHBRcwOjAsMDoxLDA6MiwwOjMsMDo0LDA6NRQrAAIWCh8CBRwxLiBHZXR0aW5nIHN0YXJ0ZWQgd2l0aCBNVkMjHwMFHDEuIEdldHRpbmcgc3RhcnRlZCB3aXRoIE1WQyMfBAUrL0dldHRpbmdfc3RhcnRlZF93aXRoX01WQ1NoYXJwL0RlZmF1bHQuYXNweB8FBSsvZ2V0dGluZ19zdGFydGVkX3dpdGhfbXZjc2hhcnAvZGVmYXVsdC5hc3B4HwZnZBQrAAIWCh8CBRQyLiBUYXNrcyBpbnRlcmFjdGlvbh8DBRQyLiBUYXNrcyBpbnRlcmFjdGlvbh8EBR8vVGFza3NfSW50ZXJhY3Rpb24vRGVmYXVsdC5hc3B4HwUFHy90YXNrc19pbnRlcmFjdGlvbi9kZWZhdWx0LmFzcHgfBmdkFCsAAhYKHwIFHjMuIFVzaW5nIFdpbmZvcm1zIHZpZXdzIGVuZ2luZR8DBR4zLiBVc2luZyBXaW5mb3JtcyB2aWV3cyBlbmdpbmUfBAUpL1VzaW5nX1dpbmZvcm1zX3ZpZXdzX2VuZ2luZS9EZWZhdWx0LmFzcHgfBQUpL3VzaW5nX3dpbmZvcm1zX3ZpZXdzX2VuZ2luZS9kZWZhdWx0LmFzcHgfBmdkFCsAAhYOHwIFKDQuIFJld29ya2luZyBBU1AuTkVUIE1WQyBTdG9yZSB3aXRoIE1WQyMfAwUoNC4gUmV3b3JraW5nIEFTUC5ORVQgTVZDIFN0b3JlIHdpdGggTVZDIx8EBSgvUmV3b3JraW5nX0FTUE5FVF9NVkNfU3RvcmUvRGVmYXVsdC5hc3B4HwUFKC9yZXdvcmtpbmdfYXNwbmV0X212Y19zdG9yZS9kZWZhdWx0LmFzcHgfBmceCFNlbGVjdGVkZx8HZ2QUKwACFgofAgUZNS4gQWR2YW5jZWQgQ3VzdG9taXphdGlvbh8DBRk1LiBBZHZhbmNlZCBDdXN0b21pemF0aW9uHwQFJC9BZHZhbmNlZF9DdXN0b21pemF0aW9uL0RlZmF1bHQuYXNweB8FBSQvYWR2YW5jZWRfY3VzdG9taXphdGlvbi9kZWZhdWx0LmFzcHgfBmdkFCsAAhYKHwIFGjYuIFNpbHZlcmxpZ2h0IGFuZCAuTkVUIENGHwMFGjYuIFNpbHZlcmxpZ2h0IGFuZCAuTkVUIENGHwQFES9TaWx2ZXJsaWdodC5hc3B4HwUFES9zaWx2ZXJsaWdodC5hc3B4HwZnZBQrAAIWCh8CBQhBUEkgRG9jcx8DBQhBUEkgRG9jcx8EBRQvQVBJX0RvY3MvSW5kZXguYXNweB8FBRQvYXBpX2RvY3MvaW5kZXguYXNweB8GZ2QUKwACFgofAgULRGV2ZWxvcG1lbnQfAwULRGV2ZWxvcG1lbnQfBAURL0RldmVsb3BtZW50LmFzcHgfBQURL2RldmVsb3BtZW50LmFzcHgfBmcUKwAFBQ8wOjAsMDoxLDA6MiwwOjMUKwACFgofAgUYMS4gQmFzaWNzIG9mIE1WQyBhbmQgTVZQHwMFGDEuIEJhc2ljcyBvZiBNVkMgYW5kIE1WUB8EBSMvQmFzaWNzX29mX01WQ19hbmRfTVZQL0RlZmF1bHQuYXNweB8FBSMvYmFzaWNzX29mX212Y19hbmRfbXZwL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUmMi4gSW1wbGVtZW50aW5nIGNvcmUgTVZQIGZ1bmN0aW9uYWxpdHkfAwUmMi4gSW1wbGVtZW50aW5nIGNvcmUgTVZQIGZ1bmN0aW9uYWxpdHkfBAUxL0ltcGxlbWVudGluZ19jb3JlX01WUF9mdW5jdGlvbmFsaXR5L0RlZmF1bHQuYXNweB8FBTEvaW1wbGVtZW50aW5nX2NvcmVfbXZwX2Z1bmN0aW9uYWxpdHkvZGVmYXVsdC5hc3B4HwZnZBQrAAIWCh8CBSIzLiBEZXNpZ25pbmcgV2luZm9ybXMgdmlld3MgZW5naW5lHwMFIjMuIERlc2lnbmluZyBXaW5mb3JtcyB2aWV3cyBlbmdpbmUfBAUtL0Rlc2lnbmluZ19XaW5mb3Jtc192aWV3c19lbmdpbmUvRGVmYXVsdC5hc3B4HwUFLS9kZXNpZ25pbmdfd2luZm9ybXNfdmlld3NfZW5naW5lL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUeNC4gU3Ryb25nbHkgdHlwZWQgYXNzb2NpYXRpb25zHwMFHjQuIFN0cm9uZ2x5IHR5cGVkIGFzc29jaWF0aW9ucx8EBSkvU3Ryb25nbHktdHlwZWRfYXNzb2NpYXRpb25zL0RlZmF1bHQuYXNweB8FBSkvc3Ryb25nbHktdHlwZWRfYXNzb2NpYXRpb25zL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUHQ2hhbmdlcx8DBQdDaGFuZ2VzHwQFDS9DaGFuZ2VzLmFzcHgfBQUNL2NoYW5nZXMuYXNweB8GZ2QUKwACFgofAgUIRmVlZGJhY2sfAwUIRmVlZGJhY2sfBAUOL0ZlZWRiYWNrLmFzcHgfBQUOL2ZlZWRiYWNrLmFzcHgfBmdkFCsAAhYKHwIFCERvd25sb2FkHwMFCERvd25sb2FkHwQFDi9Eb3dubG9hZC5hc3B4HwUFDi9kb3dubG9hZC5hc3B4HwZnZGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFCmN0bDAwJE1lbnXsaFW1Ql0IFTgRLJ5NmfhLpvxjtQ==" />

        <div id="pageWrapper">
            
            <div>
                <img id="ctl00_logo" src="../Images/logo.PNG" border="0" />
                <div id="breadcrumbs">
                    <div><img id="ctl00_spacer" src="../Images/spacer.bmp" height="1" width="875" border="0" /></div>
                    <span id="ctl00_SiteMapPath"><a href="#ctl00_SiteMapPath_SkipLink"><img alt="Skip Navigation Links" height="0" width="0" src="../WebResourcee862.gif?d=-tf2UOPilGOzHQ2P_iOPlg2&amp;t=633440833918844552" border="0" /></a><span><a href="../Default.html">Home</a></span><span>&#160;&gt;&#160;</span><span><a href="../Documentation.html">Documentation</a></span><span>&#160;&gt;&#160;</span><span><a href="../Examples.html">Examples</a></span><span>&#160;&gt;&#160;</span><span>4. Reworking ASP.NET MVC Store with MVC#</span><a id="ctl00_SiteMapPath_SkipLink"></a></span>
                </div>
            </div>
            <div id="menuAndContent">
                <div id="menu">
                    <a href="#ctl00_Menu_SkipLink"><img alt="Skip Navigation Links." src="../WebResourcee862.gif?d=-tf2UOPilGOzHQ2P_iOPlg2&amp;t=633440833918844552" width="0" height="0" border="0" /></a><table id="ctl00_Menu" cellpadding="0" cellspacing="0" border="0" width="238"><tr><td>
	<table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Documentation.html" id="ctl00_Menun0">Documentation</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Overview/Default.html" id="ctl00_Menun1">Overview</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Examples.html" id="ctl00_Menun2">Examples</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Getting_started_with_MVCSharp/Default.html" id="ctl00_Menun3">1. Getting started with MVC#</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Tasks_Interaction/Default.html" id="ctl00_Menun4">2. Tasks interaction</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Using_Winforms_views_engine/Default.html" id="ctl00_Menun5">3. Using Winforms views engine</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItemSelected menuItem"><a class="menuItemSelected menuItem" href="Default.html" id="ctl00_Menun6">4. Reworking ASP.NET MVC Store with MVC#</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Advanced_Customization/Default.html" id="ctl00_Menun7">5. Advanced Customization</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Silverlight.html" id="ctl00_Menun8">6. Silverlight and .NET CF</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="http://mvcsharp.org/API_Docs/Index.aspx" id="ctl00_Menun9">API Docs</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Development.html" id="ctl00_Menun10">Development</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Changes.html" id="ctl00_Menun15">Changes</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Feedback.html" id="ctl00_Menun16">Feedback</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Download.html" id="ctl00_Menun17">Download</a></td>
		</tr>
	</table>
</td></tr></table><a id="ctl00_Menu_SkipLink"></a>
                </div> 
                <div id="content">  
                    
    <h1>
        Reworking ASP.NET MVC Store with MVC# Framework</h1>
    <p>
        <em>The source code of this example can be found under "Examples\ASP.NET MVC Store\" subfolder
            of the MVC# framework root folder. The framework itself can be downloaded from <a
                href="http://www.mvcsharp.org/Download.aspx">www.MVCSharp.org/download.aspx</a>.</em></p>        
    <p>
        <a href="#Introduction">Introduction</a><br />
        <a href="#A simple store application">A simple store application</a><br />
        <a href="#The Model is first">The Model is first</a><br />
        <a href="#Application Logic">Application Logic</a><br />
        &nbsp; &nbsp; <a href="#Understanding Controllers">Understanding Controllers</a><br />
        &nbsp; &nbsp; <a href="#Task concept">Task concept</a><br />
        &nbsp; &nbsp; <a href="#Product Categories Controller">Product Categories Controller</a><br />
        &nbsp; &nbsp; <a href="#Products Controller">Products Controller</a><br />
        &nbsp; &nbsp; <a href="#Edit Product Controller">Edit Product Controller</a><br />
        <a href="#Presentation">Presentation</a><br />
        &nbsp; &nbsp; <a href="#Welcome View">Welcome View</a><br />
        &nbsp; &nbsp; <a href="#Product Categories View">Product Categories View</a><br />
        &nbsp; &nbsp; <a href="#Products View">Products View</a><br />
        &nbsp; &nbsp; <a href="#Edit Product View">Edit Product View</a><br />
        <a href="#Starting the Application">Starting the Application</a><br />
        <a href="#Summary">Summary</a><br />
        </p>                
    <a id="Introduction"></a><h2>
        Introduction</h2>
    <p>
        Not long ago Microsoft introduced their Model-View-Controller framework under ASP.NET
        MVC name. It provides a toolset for building well-designed testable 3-tier applications,
        which follow the Model-View-Controller pattern. However MVC is not not the only
        one architectural solution for constructing 3-tier applications. Another well known
        approach is the Model-View-Presenter pattern. MVP pattern appeared about 10 years
        after MVC originated. It was designed to be an evolution of MVC and to eliminate
        the drawbacks of the latter. And indeed, Model-View-Presenter has a number of advantages
        over MVC, which make MVP more favourable choice than MVC for many applications.</p>
    <p>
        In this article we are concerning a new Model-View-Presenter framework under .NET
        platform named <a href="http://www.mvcsharp.org/" title="Model-View-Presenter for .NET">MVC#</a>. The article is based
        on the classic ASP.NET MVC example application by Scott Guthrie (described here:
        <a href="http://weblogs.asp.net/scottgu/archive/2007/11/13/asp-net-mvc-framework-part-1.aspx">
            part 1</a>, <a href="http://weblogs.asp.net/scottgu/archive/2007/12/03/asp-net-mvc-framework-part-2-url-routing.aspx">
                2</a>, <a href="http://weblogs.asp.net/scottgu/archive/2007/12/06/asp-net-mvc-framework-part-3-passing-viewdata-from-controllers-to-views.aspx">
                    3</a>, <a href="http://weblogs.asp.net/scottgu/archive/2007/12/09/asp-net-mvc-framework-part-4-handling-form-edit-and-post-scenarios.aspx">
                        4</a>). But here we are going to reimplement this example with the
        use of MVC# Framework, showing the strong points of MVC# (and MVP pattern overall)
        over ASP.NET MVC.</p>
    <a id="A simple store application"></a><h2>
        A simple store application</h2>
    <p>
        The ASP.NET MVC application we are going to rework consists of several views. We
        will deal with four of them: "Welcome" view, "Product Categories" view, "Products"
        view - to list products within a specific category, and "Edit Product" view to show/edit
        details for a chosen product.</p>
    <p>
        If a user clicks on some category in the categories list he should be navigated
        to the products view for that category. If he clicks "Edit" against some product
        in the products view then the "Edit Product" view should be opened for that product.
        Finally, a user should be able to modify the product details (in the "Edit Product"
        view) and commit changes by clicking the "Save" button.</p>
    <p><img src="Images/0.jpg"/></p>
    <a id="The Model is first"></a><h2>
        The Model is first</h2>
    <p>
        Model is the core of every application. It contains definitions for the application
        domain concepts, which the rest of the application relies on. That is why applications'
        design is often started with constructing the model.</p>
    <p>
        As for implementing the Model tier several approaches are applicable here. A developer
        may use the conventional .NET 2.0 datasets, or more object-oriented brand new Linq
        + Entity Framework toolset, or third-party tools such as NHibernate or CapableObjects
        ECO. Anyway neither ASP.NET MVC nor MVC# restrict developers in choosing the Model
        layer implementation technique.</p>
    <p>
        Our example model will include three domain concepts: Categories, Suppliers and
        Products. The relationships between these concepts are quite simple: each product
        belongs to some category and some supplier. For maximum capability we will use typed
        datasets to implement the Model tier. So this is how our model will look in Visual
        Studio dataset designer:</p>
    <p><img src="Images/01.jpg"/>&nbsp;</p>
    <p>
        To provide a uniform access to the Model objects we will also apply the Sigleton pattern
        to the dataset class. As a result we will easily access domain objects through the
        <code>NorthwindDataSet.Instance</code> object.</p>
    <a id="Application Logic"></a><h2>
        Application Logic</h2>
    <p>
        Application logic is the middle tier of 3-tier systems. It contains the logic of how
        the domain model is applied and of what actually happens (application flow in other
        words). In MVP/MVC the Application logic tier consists mainly of Controller objects.
        Some frameworks (including MVC#) also add Task objects to the Application logic
        tier. Next we will talk about controllers and tasks and how they are used in our
        example application.</p>
    <a id="Understanding Controllers"></a><h3>
        Understanding Controllers</h3>
    <p>
        Probably the main difference between MVC and MVP is the difference between what
        is called Controller in these patterns. For this reason the Controller in MVP is
        even referred to as "Presenter", nevertheless many authors prefer calling it "Controller"
        (and so do we). Let us look into the Controllers' peculiarities in the Model-View-Controller
        and Model-View-Presenter patterns.</p>
    <p>
        MVC pattern (and, specifically, ASP.NET MVC framework) breaks the standard ASP.NET
        web request processing scheme. According to MVC web requests (user gestures) are
        processed by the appropriate Controller objects instead of being processed by web
        pages. Based on the incoming request URL ASP.NET MVC framework chooses the controller
        to process the request. The chosen controller then makes necessary calls to the
        Model tier and chooses the view to be shown, also passing the needed data to that
        view.</p>
    <p><img src="Images/1.jpg"/></p>
    <p>
        MVP pattern, on the contrary, does not violate the standard ASP.NET web request
        processing model. According to MVP web pages do receive web requests (user gestures).
        But, instead of processing requests itself, a web page delegates this job to the
        associated controller. The controller then, just as in MVC, makes necessary calls
        to the model and decides what to show to the user.</p>
    <p>
        The said difference underlies one major drawback of the MVC pattern. The thing is
        that MVC requires all user gestures to trigger a request of URL in a specific form
        (say, http://domain/[Controller]/[Action]). However, most of ASP.NET controls do
        not conform to this requirement. Instead, they generate web page events in response
        to user gestures. It means that ASP.NET server controls (especially third-party)
        better fit MVP scheme, with user gestures handled by views (web pages), and do not
        clearly fit MVC.</p>
    <a id="Task concept"></a><h3>
        Task concept</h3>
    <p>
        By task we mean a set of views which a user traverses to fulfil some job. For example
        an airline ticket booking task may consist of two views: one for choosing the flight,
        the other - for entering personal information. Tasks often correspond to certain
        use cases of the system: there may be "Login to the system" and "Process order"
        use cases and tasks of the same names. Finally, a task may be associated with a
        state machine or a workflow: for example "Process order" task could be implemented
        with the "Process order" workflow in WWF.</p>
    <p>
        Although not present in MVC and MVP patterns, task concept proves useful in various
        applications. That is why it is implemented in MVC# in addition to the controller
        and view concepts.</p>
    <p>
        Real-life systems may consist of dozens of tasks, however our simple application
        will include only one task - Main Task. This task will consist of four views mentioned
        earlier: "Welcome", "Product Categories", "Products" and "Edit Product". A view-controller
        is referred to as interaction point. Thus, we need to declare a task with four interaction
        points. In MVC# interaction points are defined by string constant fields equipped
        with <code>[IPoint]</code> attribute:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> MainTask : TaskBase
    {
        [IPoint(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(ControllerBase), </span><span style="color: #0000FF;">true</span><span style="color: #000000;">)]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">const</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> Welcome </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Welcome</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;

        [IPoint(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(ProductCategoriesController), </span><span style="color: #0000FF;">true</span><span style="color: #000000;">, Products)]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">const</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> ProductCategories </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Product Categories</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;

        [IPoint(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(ProductsController), EditProduct)]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">const</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> Products </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Products</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;

        [IPoint(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(EditProductController))]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">const</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> EditProduct </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Edit Product</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;
    }</span></pre>
    <p>
        Each interaction point declaration includes the name of the view (value of the constant),
        the type of the controller and navigation information.</p>
    <p>
        Navigation information specifies
        the possible order in which views can be activated. For instance, <code>true</code> parameter
        value in the <code>[IPoint(typeof(...), true)]</code> attribute definition declares the view as a common navigation target. It means that this view
        can be activated at any time, regardless of the current active view. In our example
        the "Welcome" and "Product Categories" views are common targets. Next, <code>[IPoint]</code>
        attribute applied to, say, "View 1" specifies views which can be navigated to from "View 1". In our example <code>[IPoint(typeof(...), EditProduct)]</code>
        declares that "Edit Product" view can be activated (or, in other words, navigated
        to) if "Products" view is active.</p>
    <p>
        Tasks often contain global information used among several views/controllers. In
        our example a product category is chosen inside the "Product Categories" view and
        is browsed in the "Products" view. To be accessible from both these views the selected
        category will be stored in a new <code>MainTask.SelectedCategory</code> property. In the same
        way we introduce a <code>MainTask.SelectedProduct</code> property:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> MainTask : TaskBase
    ...
        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> NorthwindDataSet.CategoriesRow selectedCategory </span><span style="color: #000000;">=</span><span style="color: #000000;">
                                    NorthwindDataSet.Instance.Categories[</span><span style="color: #800080;">0</span><span style="color: #000000;">];
        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> NorthwindDataSet.ProductsRow selectedProduct </span><span style="color: #000000;">=</span><span style="color: #000000;">
                                    NorthwindDataSet.Instance.Products[</span><span style="color: #800080;">0</span><span style="color: #000000;">];

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">event</span><span style="color: #000000;"> EventHandler SelectedCategoryChanged;
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">event</span><span style="color: #000000;"> EventHandler SelectedProductChanged;

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> NorthwindDataSet.CategoriesRow SelectedCategory
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> selectedCategory; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                selectedCategory </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (SelectedCategoryChanged </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">)
                    SelectedCategoryChanged(</span><span style="color: #0000FF;">this</span><span style="color: #000000;">, EventArgs.Empty);
            }
        }

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> NorthwindDataSet.ProductsRow SelectedProduct
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> selectedProduct; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                selectedProduct </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (SelectedProductChanged </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">)
                    SelectedProductChanged(</span><span style="color: #0000FF;">this</span><span style="color: #000000;">, EventArgs.Empty);
            }
        }</span></pre>
    <p>
        The last thing left to do with the task - is to define actions performed on task
        start. This is done by implementing the <code>ITask.OnStart(...)</code> method:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> MainTask : TaskBase
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OnStart(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> param)
        {
            Navigator.NavigateDirectly(Welcome);
        }</span></pre>
    <p>
        As seen above, we are simply activating the "Welcome" view when the task is started.
        <code>NavigateDirectly</code> method is used instead of <code>Navigate</code> to switch views ignoring any navigation routes.</p>
    <a id="Product Categories Controller"></a><h3>
        Product Categories Controller</h3>
    <p>
        As we already know, processing of every user gesture should be delegated to the
        corresponding controller method. If no user gestures are applicable, a simple operationless
        <code>ControllerBase</code> may be used. This is the case with the "Welcome" view in our example.</p>
    <p>
        Inside the "Product Categories" view a user can choose a specific category. The
        processing of this gesture should be delegated to the <code>ProductCategoriesController.CategorySelected(...)</code>
        method. We could immediately proceed to writing the body of this method, but instead
        let us firstly write the test case for it, in full accordance with Test Driven Development
        (TDD) principles:</p>
    <pre><span style="color: #000000;">    [TestFixture]
    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> TestProductCategoriesController
    ...
        [Test]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> TestCategorySelected()
        {
            NorthwindDataSet.CategoriesRow cat </span><span style="color: #000000;">=</span><span style="color: #000000;">
                NorthwindDataSet.Instance.Categories.NewCategoriesRow();
            controller.CategorySelected(cat);

            Assert.AreSame(cat, controller.Task.SelectedCategory);
            Assert.AreEqual(MainTask.Products, controller.Task.CurrViewName);
        }</span></pre>
    <p>
        The first NUnit assertion checks that the controller stores the selected category
        in the task's <code>SelectedCategory</code> property. The second assertion ensures that the controller
        performs navigation to the "Products" view (by checking the task's <code>CurrViewName</code>
        property).</p>
    <p>
        Of course, some test setup is needed to link the participating objects together.
        In the setup we are using the stub navigator implementation - it does not perform
        navigation, only changes the task state -
        which is ideal for test cases:</p>
    <pre><span style="color: #000000;">    [TestFixture]
    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> TestProductCategoriesController
    ...
        [SetUp]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> TestSetup()
        {
            controller </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> ProductCategoriesController();
            controller.Task </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> MainTask();
</span><span style="color: #000000;">            controller.Task.Navigator </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> StubNavigator();
            controller.Task.Navigator.Task </span><span style="color: #000000;">=</span><span style="color: #000000;"> controller.Task;
</span><span style="color: #000000;">        }</span></pre>
    <p>
        Now that the test for the <code>CategorySelected</code> method is ready let us write
        its body:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ProductCategoriesController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask,
                                                IProductCategoriesView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> CategorySelected(NorthwindDataSet.CategoriesRow selectedCat)
        {
            Task.SelectedCategory </span><span style="color: #000000;">=</span><span style="color: #000000;"> selectedCat;
            Task.Navigator.Navigate(MainTask.Products);
        }</span></pre>
    <p>
        Note that controllers in MVC# should implement the <code>IController</code> interface. But instead
        of implementing it manually it is recommended to inherit its base generic implementation
        <code>ControllerBase&lt;TTask, TView&gt;</code> (specifying the expected task and view types
        as generic parameters).</p>
    <p>
        Another thing that a controller should do is the view initialization. View initialization
        is usually done when a controller is linked to its view, i.e. in the <code>IController.View</code>
        setter method. In our example
        the product categories view should be initialized to list all possible categories. Again, we will start with the test case which will check the correctness
        of initialization:</p>
    <pre><span style="color: #000000;">    [TestFixture]
    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> TestProductCategoriesController
    ...
        [Test]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> TestViewInitialization()
        {
            controller.View </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> StubProductCategoriesView();

            Assert.AreSame((NorthwindDataSet.Instance.Categories </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IListSource)
                            .GetList(), controller.View.CategoriesList); 
        }</span></pre>
    <p>
        StubProductCategoriesView is a simple test-aimed IProductCategoriesView implementation
        with a backing field. Code to satisfy the above test case will look as follows:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ProductCategoriesController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask,
                                                IProductCategoriesView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> IProductCategoriesView View
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.View; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.View </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                View.CategoriesList </span><span style="color: #000000;">=</span><span style="color: #000000;"> (NorthwindDataSet.Instance.Categories
                                                        </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IListSource).GetList();
            }
        }</span></pre>
    <p>
        Running the tests indicates our success:</p>
    <p><img src="Images/1a.jpg" />&nbsp; </p>
    <a id="Products Controller"></a><h3>
        Products Controller</h3>
    <p>
        In the "Products" view a user may click "Edit" against some product. Processing
        of this gesture should be delegated to the controller's <code>EditProduct(...)</code> method.
        This method, in its turn, should store the product chosen in the task's <code>SelectedProduct</code>
        property, and then navigate to the "Edit Product" view. For brevity we will omit
        the test case listing here, and will list only the <code>EditProduct</code> method itself:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ProductsController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask, IProductsView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> EditProduct(NorthwindDataSet.ProductsRow product)
        {
            Task.SelectedProduct </span><span style="color: #000000;">=</span><span style="color: #000000;"> product;
            Task.Navigator.Navigate(MainTask.EditProduct);
        }</span></pre>
    <p>
        View initialization code should setup the view to show the contents of the current
        category:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ProductsController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask, IProductsView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> IProductsView View
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.View; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.View </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                View.Category </span><span style="color: #000000;">=</span><span style="color: #000000;"> Task.SelectedCategory;
            }
        }</span></pre>
    <p>
        The Products Controller should also track the change of the selected category and,
        if a user selects another category, it should accordingly change the category browsed
        in the products view. To track the change of the current category we will
        subscribe to the Task's <code>SelectedCategoryChanged</code> event inside the <code>ProductsController.Task</code>
        setter method:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ProductsController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask, IProductsView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> MainTask Task
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.Task; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.Task </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                Task.SelectedCategoryChanged </span><span style="color: #000000;">+=</span><span style="color: #000000;"> SelectedCategoryChanged;
            }
        }

        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> SelectedCategoryChanged(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, EventArgs e)
        {
            View.Category </span><span style="color: #000000;">=</span><span style="color: #000000;"> Task.SelectedCategory;
        }</span></pre>
    <a id="Edit Product Controller"></a><h3>
        Edit Product Controller</h3>
    <p>
        The only operation applicable in the "Edit Product" view is committing the changes done
        to the edited product. The corresponding controller method will be <code>EditProductController.Commit()</code>:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EditProductController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask, IEditProductView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    {
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Commit()
        {
            NorthwindDataSet.ProductsRow product </span><span style="color: #000000;">=</span><span style="color: #000000;"> Task.SelectedProduct;
            product.ProductName </span><span style="color: #000000;">=</span><span style="color: #000000;"> View.ProductName;
            product.CategoriesRow </span><span style="color: #000000;">=</span><span style="color: #000000;"> View.Category;
            product.SuppliersRow </span><span style="color: #000000;">=</span><span style="color: #000000;"> View.Supplier;
            product.UnitPrice </span><span style="color: #000000;">=</span><span style="color: #000000;"> View.UnitPrice;
        }</span></pre>
    <p>
        As always, the controller should initialize the view:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EditProductController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask, IEditProductView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> IEditProductView View
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.View; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.View </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                InitViewData();
            }
        }

</span><span style="color: #000000;">        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> InitViewData()
        {
            View.ProductName </span><span style="color: #000000;">=</span><span style="color: #000000;"> Task.SelectedProduct.ProductName;
            View.Category </span><span style="color: #000000;">=</span><span style="color: #000000;"> Task.SelectedProduct.CategoriesRow;
            View.Supplier </span><span style="color: #000000;">=</span><span style="color: #000000;"> Task.SelectedProduct.SuppliersRow;
            View.UnitPrice </span><span style="color: #000000;">=</span><span style="color: #000000;"> Task.SelectedProduct.UnitPrice;
        }</span></pre>
    <p>
        And the controller should track the change of the selected customer, and accordingly
        fill the view:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EditProductController : ControllerBase</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainTask, IEditProductView</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> MainTask Task
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.Task; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                </span><span style="color: #0000FF;">base</span><span style="color: #000000;">.Task </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                Task.SelectedProductChanged </span><span style="color: #000000;">+=</span><span style="color: #000000;"> SelectedProductChanged;
            }
        }

        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> SelectedProductChanged(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, EventArgs e)
        {
            InitViewData();
        }</span></pre>
    <a id="Presentation"></a><h2>
        Presentation</h2>
    <a id="Welcome View"></a><h3>
        Welcome View</h3>
    <p>
        All our four views will use the same master page, containing a header and a menu
        stripe. Welcome view will be the default web page (Default.aspx) and will contain
        nothing but the welcome phrase:</p>
    <p><img src="Images/2.jpg"/>&nbsp;</p>
    <p>
        Views in MVC# should implement the <code>IView</code> interface. For this reason all our views
        inherit a base <code>IView</code> implementation - <code>WebFormView</code> (or
        its generic version <code>WebFormView&lt;T&gt;</code> with a controller type specified as generic
        parameter).</p>
    <a id="Product Categories View"></a><h3>
        Product Categories View</h3>
    <p>
        As we mentioned earlier most of ASP.NET controls with their server-side events better
        fit the Model-View-Presenter paradigm, rather than MVC. Therefore building user
        interfaces in MVC# applications is generally easier than with ASP.NET MVC framework.</p>
    <p>
        Like we did to the Welcome view, we make the Product Categories view use the same
        master page and inherit from <code>WebFormView&lt;T&gt;</code>. Then we place a DataList
        control on the form:</p>
    <p><img src="Images/3.jpg"/>&nbsp;</p>
    <p>
        Next, let us edit an item template of the DataList control. Inside this template
        we will put a link button named "CategoryLinkButton" and then will configure data
        bindings for it by selecting "Edit DataBindings..." from the context menu. Data
        Bindings configuration dialog should be opened:</p>
    <p><img src="Images/4.jpg"/>&nbsp;</p>
    <p>
        For each link's text to be the name of the corresponding category we set the Text
        property binding to <code>Eval("CategoryName")</code>.</p>
    <p>
        As we already know, actual categories list is passed by controller through the <code>IProductCategories</code>
        interface. Hence this interface should be implemented by the product categories
        view:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ProductCategories : 
           WebFormView</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ProductCategoriesController</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">, IProductCategoriesView
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> IList CategoriesList
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> CategoriesDataList.DataSource </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IList; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                CategoriesDataList.DataSource </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                DataBind();
            }
        }</span></pre>
    <p>
        Finally, we should make the view handle category selection. As soon as a category link
        is clicked the processing should be delegated to the controller's <code>CategorySelected(...)</code>
        method (which we have already implemented). For this let us add a handler for the
        <code>ItemCommand</code> event of the <code>CategoriesDataList</code> control:</p>
    <p><img src="Images/5.jpg"/>&nbsp;</p>
    <p>
        The handler, as we said, should pass the selected category to the controller's <code>CategorySelected(...)</code>
        method:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ProductCategories : 
           WebFormView</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ProductCategoriesController</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">, IProductCategoriesView
    ...
        </span><span style="color: #0000FF;">protected</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> CategoriesDataList_ItemCommand(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> source,
                                    DataListCommandEventArgs e)
        {
            DataRowView rv </span><span style="color: #000000;">=</span><span style="color: #000000;"> CategoriesList[e.Item.ItemIndex] </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> DataRowView;
            Controller.CategorySelected(rv.Row </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> NorthwindDataSet.CategoriesRow);
        }</span></pre>
    <a id="Products View"></a><h3>
        Products View</h3>
    <p>
        The Products view is similar in many aspects to the Product Categories view: it
        contains a list of objects (implemented with DataList control) with links to choose
        any one of them. Due to this similarity we will omit the description of any details.</p>
    <p>
        Below is how the <code>IProductsView</code> interface implemented:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> Products : WebFormView</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ProductsController</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">, IProductsView
    ...
        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> NorthwindDataSet.CategoriesRow category;

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> NorthwindDataSet.CategoriesRow Category
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> category; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;">
            {
                category </span><span style="color: #000000;">=</span><span style="color: #000000;"> value;
                ProductsDataList.DataSource </span><span style="color: #000000;">=</span><span style="color: #000000;"> Category.GetProductsRows();
                CategoryNameLabel.Text </span><span style="color: #000000;">=</span><span style="color: #000000;"> Category.CategoryName;
                DataBind();
            }
        }</span></pre>
    <p>
        Processing the "Edit" links click is done in the same way as we did in the "Product
        Categories" view - by handling the <code>DataList.ItemCommand</code> event:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> Products : WebFormView</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ProductsController</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">, IProductsView
    ...
        </span><span style="color: #0000FF;">protected</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> ProductsDataList_ItemCommand(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> source,
                                  DataListCommandEventArgs e)
        {
            </span><span style="color: #0000FF;">object</span><span style="color: #000000;"> itm </span><span style="color: #000000;">=</span><span style="color: #000000;"> (ProductsDataList.DataSource </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IList)[e.Item.ItemIndex];
            Controller.EditProduct(itm </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> NorthwindDataSet.ProductsRow);
        }</span></pre>
    <a id="Edit Product View"></a><h3>
        Edit Product View</h3>
    <p>
        And again, steps to build the view are the same here: inherit the view from <code>WebFormView&lt;T&gt;</code>
        specifying the controller type, then design the view surface, then make it implement
        the proper view interface (<code>IEditProductView</code>), and finally make it handle user gestures
        by delegating the work to the controller. Since the steps are analogous
        we will skip them and proceed to the next article part. If desired, a reader may
        see how the view is implemented in the example source code.</p>
    <a id="Starting the Application"></a><h2>
        Starting the Application</h2>
    <p>
        Starting an MVC# application means just starting one of its tasks. In our case we
        will start the Main Task. The common place in ASP.NET programs for the initial task
        staring code is the session start handler (in Global.asax file):</p>
    <pre><span style="color: #008000;">&lt;!--</span><span style="color: #008000;">-------------------- Global.asax file ------------------</span><span style="color: #008000;">--&gt;</span><span style="color: #000000;">
</span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">script </span><span style="color: #FF0000;">runat</span><span style="color: #0000FF;">=&quot;server&quot;</span><span style="color: #0000FF;">&gt;</span>
    ...
<span style="color: #0000FF;">    public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Session_Start(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, EventArgs e)
    {
        TasksManager tm </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> TasksManager(WebformsViewsManager.
                                               GetDefaultConfig());
        tm.StartTask(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(MainTask));
    }</span></pre>
    <p>
        As seen above, we are using a <code>TasksManager</code> instance to start the task. However each
        tasks manager requires some configuration before using it. Above we are passing
        a standard configuration object intended for Web applications to the tasks manager
        constructor.</p>
    <p>
        Last thing left to do - is to define mapping between views and corresponding web
        pages. For this we should add the following code to the Global.asax &lt;script&gt;
        block:</p>
    <pre><span style="color: #008000;">&lt;!--</span><span style="color: #008000;">-------------------- Global.asax file ------------------</span><span style="color: #008000;">--&gt;</span><span style="color: #000000;">
</span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">script </span><span style="color: #FF0000;">runat</span><span style="color: #0000FF;">=&quot;server&quot;</span><span style="color: #0000FF;">&gt;</span>
    ...    
<span style="color: #000000;">    [WebformsView(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(MainTask), MainTask.Welcome, </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Default.aspx</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">)]
    [WebformsView(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(MainTask), MainTask.ProductCategories,
                                            </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">ProductCategories.aspx</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">)]
    [WebformsView(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(MainTask), MainTask.Products, </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Products.aspx</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">)]
    [WebformsView(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(MainTask), MainTask.EditProduct, </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">EditProduct.aspx</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">)]
    </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ViewDescriptions { }</span></pre>
    <p>
        That is all, we have successfully finished our example application, and it is ready
        to run!</p>
    <a id="Summary"></a><h2>
        Summary</h2>
    <p>
        We have learned how to create 3-tier Model-View-Presenter applications with the
        help of <a href="http://www.mvcsharp.org/" title=".NET Model-View-Presenter">MVC# framework</a>.
        As an example we have chosen the ASP.NET MVC sample application to demonstrate all
        advantages of MVC# over ASP.NET MVC and other MVC frameworks. Applications done with
        MVC# are no less structured and testable and better suit modern UI controls than
        those built with existing MVC frameworks. In addition we should say that MVC# has
        support for other presentation platforms (Winforms, in plans: Silverlight and WPF)
        allowing to run the same application under different GUIs.</p>
    <p>
        <em>The source code of this example can be found under "Examples\ASP.NET MVC Store\"
            subfolder of the MVC# framework root folder. The framework itself can be downloaded from <a
                href="http://www.mvcsharp.org/Download.aspx">www.MVCSharp.org/download.aspx</a>.</em></p>        

                </div>
            </div>
        </div>
        <div style="text-align:center; font-size:11px;">Copyright © www.MVCSharp.org</div>
    </form>
</body>

<!-- Mirrored from mvcsharp.org/Reworking_ASPNET_MVC_Store/Default.aspx by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 30 Oct 2008 03:47:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>
