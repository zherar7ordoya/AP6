

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from mvcsharp.org/Tasks_Interaction/Default.aspx by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 30 Oct 2008 03:46:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head><title>
	Tasks interaction
</title><link href="../Styles.css" rel="stylesheet" type="text/css" /></head>
<body>
    <form name="aspnetForm" method="post" action="http://mvcsharp.org/Tasks_Interaction/Default.aspx" id="aspnetForm">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTEwMDUyNjYzMjgPZBYCZg9kFgICAw9kFgICCQ88KwAJAgAPFgQeDU5ldmVyRXhwYW5kZWRkHgtfIURhdGFCb3VuZGdkCBQrAAUFDzA6MCwwOjEsMDoyLDA6MxQrAAIWDB4EVGV4dAUNRG9jdW1lbnRhdGlvbh4FVmFsdWUFDURvY3VtZW50YXRpb24eC05hdmlnYXRlVXJsBRMvRG9jdW1lbnRhdGlvbi5hc3B4HghEYXRhUGF0aAUTL2RvY3VtZW50YXRpb24uYXNweB4JRGF0YUJvdW5kZx4IRXhwYW5kZWRnFCsABQUPMDowLDA6MSwwOjIsMDozFCsAAhYKHwIFCE92ZXJ2aWV3HwMFCE92ZXJ2aWV3HwQFFi9PdmVydmlldy9EZWZhdWx0LmFzcHgfBQUWL292ZXJ2aWV3L2RlZmF1bHQuYXNweB8GZ2QUKwACFgwfAgUIRXhhbXBsZXMfAwUIRXhhbXBsZXMfBAUOL0V4YW1wbGVzLmFzcHgfBQUOL2V4YW1wbGVzLmFzcHgfBmcfB2cUKwAHBRcwOjAsMDoxLDA6MiwwOjMsMDo0LDA6NRQrAAIWCh8CBRwxLiBHZXR0aW5nIHN0YXJ0ZWQgd2l0aCBNVkMjHwMFHDEuIEdldHRpbmcgc3RhcnRlZCB3aXRoIE1WQyMfBAUrL0dldHRpbmdfc3RhcnRlZF93aXRoX01WQ1NoYXJwL0RlZmF1bHQuYXNweB8FBSsvZ2V0dGluZ19zdGFydGVkX3dpdGhfbXZjc2hhcnAvZGVmYXVsdC5hc3B4HwZnZBQrAAIWDh8CBRQyLiBUYXNrcyBpbnRlcmFjdGlvbh8DBRQyLiBUYXNrcyBpbnRlcmFjdGlvbh8EBR8vVGFza3NfSW50ZXJhY3Rpb24vRGVmYXVsdC5hc3B4HwUFHy90YXNrc19pbnRlcmFjdGlvbi9kZWZhdWx0LmFzcHgfBmceCFNlbGVjdGVkZx8HZ2QUKwACFgofAgUeMy4gVXNpbmcgV2luZm9ybXMgdmlld3MgZW5naW5lHwMFHjMuIFVzaW5nIFdpbmZvcm1zIHZpZXdzIGVuZ2luZR8EBSkvVXNpbmdfV2luZm9ybXNfdmlld3NfZW5naW5lL0RlZmF1bHQuYXNweB8FBSkvdXNpbmdfd2luZm9ybXNfdmlld3NfZW5naW5lL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUoNC4gUmV3b3JraW5nIEFTUC5ORVQgTVZDIFN0b3JlIHdpdGggTVZDIx8DBSg0LiBSZXdvcmtpbmcgQVNQLk5FVCBNVkMgU3RvcmUgd2l0aCBNVkMjHwQFKC9SZXdvcmtpbmdfQVNQTkVUX01WQ19TdG9yZS9EZWZhdWx0LmFzcHgfBQUoL3Jld29ya2luZ19hc3BuZXRfbXZjX3N0b3JlL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUZNS4gQWR2YW5jZWQgQ3VzdG9taXphdGlvbh8DBRk1LiBBZHZhbmNlZCBDdXN0b21pemF0aW9uHwQFJC9BZHZhbmNlZF9DdXN0b21pemF0aW9uL0RlZmF1bHQuYXNweB8FBSQvYWR2YW5jZWRfY3VzdG9taXphdGlvbi9kZWZhdWx0LmFzcHgfBmdkFCsAAhYKHwIFGjYuIFNpbHZlcmxpZ2h0IGFuZCAuTkVUIENGHwMFGjYuIFNpbHZlcmxpZ2h0IGFuZCAuTkVUIENGHwQFES9TaWx2ZXJsaWdodC5hc3B4HwUFES9zaWx2ZXJsaWdodC5hc3B4HwZnZBQrAAIWCh8CBQhBUEkgRG9jcx8DBQhBUEkgRG9jcx8EBRQvQVBJX0RvY3MvSW5kZXguYXNweB8FBRQvYXBpX2RvY3MvaW5kZXguYXNweB8GZ2QUKwACFgofAgULRGV2ZWxvcG1lbnQfAwULRGV2ZWxvcG1lbnQfBAURL0RldmVsb3BtZW50LmFzcHgfBQURL2RldmVsb3BtZW50LmFzcHgfBmcUKwAFBQ8wOjAsMDoxLDA6MiwwOjMUKwACFgofAgUYMS4gQmFzaWNzIG9mIE1WQyBhbmQgTVZQHwMFGDEuIEJhc2ljcyBvZiBNVkMgYW5kIE1WUB8EBSMvQmFzaWNzX29mX01WQ19hbmRfTVZQL0RlZmF1bHQuYXNweB8FBSMvYmFzaWNzX29mX212Y19hbmRfbXZwL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUmMi4gSW1wbGVtZW50aW5nIGNvcmUgTVZQIGZ1bmN0aW9uYWxpdHkfAwUmMi4gSW1wbGVtZW50aW5nIGNvcmUgTVZQIGZ1bmN0aW9uYWxpdHkfBAUxL0ltcGxlbWVudGluZ19jb3JlX01WUF9mdW5jdGlvbmFsaXR5L0RlZmF1bHQuYXNweB8FBTEvaW1wbGVtZW50aW5nX2NvcmVfbXZwX2Z1bmN0aW9uYWxpdHkvZGVmYXVsdC5hc3B4HwZnZBQrAAIWCh8CBSIzLiBEZXNpZ25pbmcgV2luZm9ybXMgdmlld3MgZW5naW5lHwMFIjMuIERlc2lnbmluZyBXaW5mb3JtcyB2aWV3cyBlbmdpbmUfBAUtL0Rlc2lnbmluZ19XaW5mb3Jtc192aWV3c19lbmdpbmUvRGVmYXVsdC5hc3B4HwUFLS9kZXNpZ25pbmdfd2luZm9ybXNfdmlld3NfZW5naW5lL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUeNC4gU3Ryb25nbHkgdHlwZWQgYXNzb2NpYXRpb25zHwMFHjQuIFN0cm9uZ2x5IHR5cGVkIGFzc29jaWF0aW9ucx8EBSkvU3Ryb25nbHktdHlwZWRfYXNzb2NpYXRpb25zL0RlZmF1bHQuYXNweB8FBSkvc3Ryb25nbHktdHlwZWRfYXNzb2NpYXRpb25zL2RlZmF1bHQuYXNweB8GZ2QUKwACFgofAgUHQ2hhbmdlcx8DBQdDaGFuZ2VzHwQFDS9DaGFuZ2VzLmFzcHgfBQUNL2NoYW5nZXMuYXNweB8GZ2QUKwACFgofAgUIRmVlZGJhY2sfAwUIRmVlZGJhY2sfBAUOL0ZlZWRiYWNrLmFzcHgfBQUOL2ZlZWRiYWNrLmFzcHgfBmdkFCsAAhYKHwIFCERvd25sb2FkHwMFCERvd25sb2FkHwQFDi9Eb3dubG9hZC5hc3B4HwUFDi9kb3dubG9hZC5hc3B4HwZnZGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFCmN0bDAwJE1lbnVG2JErdD3+1gZsTjCastJvAxwYlw==" />

        <div id="pageWrapper">
            
            <div>
                <img id="ctl00_logo" src="../Images/logo.PNG" border="0" />
                <div id="breadcrumbs">
                    <div><img id="ctl00_spacer" src="../Images/spacer.bmp" height="1" width="875" border="0" /></div>
                    <span id="ctl00_SiteMapPath"><a href="#ctl00_SiteMapPath_SkipLink"><img alt="Skip Navigation Links" height="0" width="0" src="../WebResourcee862.gif?d=-tf2UOPilGOzHQ2P_iOPlg2&amp;t=633440833918844552" border="0" /></a><span><a href="../Default.html">Home</a></span><span>&#160;&gt;&#160;</span><span><a href="../Documentation.html">Documentation</a></span><span>&#160;&gt;&#160;</span><span><a href="../Examples.html">Examples</a></span><span>&#160;&gt;&#160;</span><span>2. Tasks interaction</span><a id="ctl00_SiteMapPath_SkipLink"></a></span>
                </div>
            </div>
            <div id="menuAndContent">
                <div id="menu">
                    <a href="#ctl00_Menu_SkipLink"><img alt="Skip Navigation Links." src="../WebResourcee862.gif?d=-tf2UOPilGOzHQ2P_iOPlg2&amp;t=633440833918844552" width="0" height="0" border="0" /></a><table id="ctl00_Menu" cellpadding="0" cellspacing="0" border="0" width="238"><tr><td>
	<table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Documentation.html" id="ctl00_Menun0">Documentation</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Overview/Default.html" id="ctl00_Menun1">Overview</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Examples.html" id="ctl00_Menun2">Examples</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Getting_started_with_MVCSharp/Default.html" id="ctl00_Menun3">1. Getting started with MVC#</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItemSelected menuItem"><a class="menuItemSelected menuItem" href="Default.html" id="ctl00_Menun4">2. Tasks interaction</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Using_Winforms_views_engine/Default.html" id="ctl00_Menun5">3. Using Winforms views engine</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Reworking_ASPNET_MVC_Store/Default.html" id="ctl00_Menun6">4. Reworking ASP.NET MVC Store with MVC#</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Advanced_Customization/Default.html" id="ctl00_Menun7">5. Advanced Customization</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Silverlight.html" id="ctl00_Menun8">6. Silverlight and .NET CF</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="http://mvcsharp.org/API_Docs/Index.aspx" id="ctl00_Menun9">API Docs</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td><table width="20">
				<tr>
					<td></td>
				</tr>
			</table></td><td class="menuItem"><a class="menuItem" href="../Development.html" id="ctl00_Menun10">Development</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Changes.html" id="ctl00_Menun15">Changes</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Feedback.html" id="ctl00_Menun16">Feedback</a></td>
		</tr>
	</table><table cellpadding="0" cellspacing="0">
		<tr>
			<td class="menuItem"><a class="menuItem" href="../Download.html" id="ctl00_Menun17">Download</a></td>
		</tr>
	</table>
</td></tr></table><a id="ctl00_Menu_SkipLink"></a>
                </div> 
                <div id="content">  
                    
<h1>Tasks interaction</h1>
    <p>
        <em>The source code of this example can be found under "Examples\TasksInteraction\" subfolder
            of the MVC# root folder. Silverlight presentation project is in the "Examples\TasksInteraction\Presentation\Silverlight"
            folder. The framework itself can be downloaded from <a
                href="http://www.mvcsharp.org/Download.aspx">www.MVCSharp.org/download.aspx</a>.</em></p>
    <p>
        <a href="#Introduction">Introduction</a><br />
        <a href="#Application logic">Application logic</a><br />
        &nbsp; &nbsp; <a href="#Main Task">Main Task</a><br />
        &nbsp; &nbsp; <a href="#Employees Controller">Employees Controller</a><br />
        &nbsp; &nbsp; <a href="#Award Bonus Task">Award Bonus Task</a><br />
        &nbsp; &nbsp; <a href="#Award Bonus Main Controller">Award Bonus Main Controller</a><br />
        &nbsp; &nbsp; <a href="#Advanced Options Controller">Advanced Options Controller</a><br />
        <a href="#Presentation">Presentation</a><br />
        &nbsp; &nbsp; <a href="#Employees view">Employees view</a><br />
        &nbsp; &nbsp; <a href="#Bonus award views">Bonus award views</a><br />        
        <a href="#Conclusion">Conclusion</a><br />
        </p>
    <a id="Introduction"></a><h2>Introduction</h2>
    <p>
        Nowadays user interfaces become more and more complex. And with the appearance of
        RIA (rich Internet application) technologies (e.g. Silverlight) even Web interfaces
        are gaining considerable complexitiy. A good way of fighting against this complexity
        is using architectural patterns, such as Model-View-Presenter.</p>
    <p>
        In my <a href="../Getting_started_with_MVCSharp/Default.html">previous article</a>
        (read it up to the "Presentation" section prior to going on with this atricle) we
        have got acquainted with <a href="http://www.mvcsharp.org/" title="Model-View-Presenter .NET">MVC#</a> - a framework which
        simplifies the usage of the Model-View-Presenter pattern by developers. There we have&nbsp;concerned an execution of a single task and have discussed interaction between
        task's views, its controllers and the task object itself. But one important question
        left uncovered is how two or more tasks interact with each other. This article considers
        an example of communication between tasks in MVC# Framework. The presentation platform we are using in this example is a brand
        new Silverlight 2.0 (which is supported by MVC# starting from version 0.8).</p>
    <a id="Application logic"></a><h2>
        Application logic</h2>
    <p>
        The example&nbsp;we concern here deals with a list of employees and allows to award
        a bonus to each employee. Bonus awarding procedure requires entering several options
        which determine the resulting bonus sum.</p>
    <p>
        We will construct the application of two tasks: one for browsing through the list
        of employees (main task), the other for awarding a bonus to a particular employee
        (bonus award task).</p>
    <a id="Main Task"></a><h3>
        Main Task</h3>
    <p>
        Main task will include a single view showing a list of employees, which will be
        activated on the task start:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> MainTask : TaskBase
    {
        [IPoint(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(EmployeesController))]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">const</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> Employees </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Employees</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OnStart(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> param)
        {
            Navigator.NavigateDirectly(Employees);
        }
    }</span></pre>
    <p>
        Besides a list of employees the employees view will contain a button (or menu item
        or whatever else) for starting a bonus award task. However the employees view will
        not start this task itself. Instead, according to the MVP pattern, this work should
        be delegated to the associated EmployeesController instance.</p>    
    <a id="Employees Controller"></a><h3>
        Employees Controller</h3>
    <p>
        As decided above the Employees controller class should contain a method (say, AwardBonus())
        for starting a bonus award task. For this task to execute, it needs to know the
        employee to be awarded. That is why we pass the current employee object to the task
        starting procedure:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EmployeesController : ControllerBase
    {
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> AwardBounus()
        {
            Employee currEmpl </span><span style="color: #000000;">=</span><span style="color: #000000;"> (View </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IEmployeesView).CurrentEmployee;
            Task.TasksManager.StartTask(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(AwardBonusTask), currEmpl);
        }
    }</span></pre>
    <p>
        After finishing its execution the bonus award task should return control to the main task.
        Thus a reference to the main task should also be passed to the bonus award task:</p>    
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EmployeesController : ControllerBase
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> AwardBounus()
        {
            Employee currEmpl </span><span style="color: #000000;">=</span><span style="color: #000000;"> (View </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IEmployeesView).CurrentEmployee;
            Task.TasksManager.StartTask(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(AwardBonusTask),
                                        </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> </span><span style="color: #0000FF;">object</span><span style="color: #000000;">[] { currEmpl, Task });
        }</span></pre>
    <p>
        Next, we will discuss the AwardBonusTask class and corresponding controller classes.</p>         
    <a id="Award Bonus Task"></a><h3>
        Award Bonus Task</h3>
    <p>
        The bonus award task will have two views. The main view will have edit boxes to
        choose some basic options and an "OK" button to award a bonus and return to the
        main task. The second view will be used for entering advanced options:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> AwardBonusTask : TaskBase
    {
        [IPoint(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(ABMainController), AdvancedOptionsView)]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">const</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> MainView </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Main View</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;

        [IPoint(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(ABAdvancedOptionsController), MainView)]
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">const</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> AdvancedOptionsView </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">&quot;</span><span style="color: #800000;">Advanced Options View</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">;
    }</span></pre>
    <p>
        When started, the bonus award task receives the employee to be awarded and the originating
        task as input parameters. These parameters are then stored in the task's public
        fields. After that the main view gets activated:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> AwardBonusTask : TaskBase
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> Employee Employee;
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> ITask OriginatingTask;

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OnStart(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> param)
        {
            Employee </span><span style="color: #000000;">=</span><span style="color: #000000;"> (param </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> </span><span style="color: #0000FF;">object</span><span style="color: #000000;">[])[</span><span style="color: #800080;">0</span><span style="color: #000000;">] </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> Employee;
            OriginatingTask</span><span style="color: #000000;">=</span><span style="color: #000000;"> (param </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> </span><span style="color: #0000FF;">object</span><span style="color: #000000;">[])[</span><span style="color: #800080;">1</span><span style="color: #000000;">] </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> ITask;
            Navigator.NavigateDirectly(MainView);
        }</span></pre>
    <a id="Award Bonus Main Controller"></a><h3>
        Award Bonus Main Controller</h3>        
    <p>
        In the bonus award main view when a user decides to award a bonus and clicks
        "OK" the control should be passed to the ABMainController.DoAwardBonus() method.
        This method calculates the bonus sum, assigns it to the employee and returns control
        back to the main task:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ABMainController : ControllerBase
    {
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> DoAwardBonus()
        {
            </span><span style="color: #0000FF;">int</span><span style="color: #000000;"> contractsMade </span><span style="color: #000000;">=</span><span style="color: #000000;"> (View </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IABMainView).ContractsMade;
            </span><span style="color: #0000FF;">int</span><span style="color: #000000;"> customersAttracted </span><span style="color: #000000;">=</span><span style="color: #000000;"> (View </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> IABMainView).CustomersAttracted;
            </span><span style="color: #0000FF;">decimal</span><span style="color: #000000;"> baseSalary </span><span style="color: #000000;">=</span><span style="color: #000000;"> (Task </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> AwardBonusTask).Employee.BaseSalary;
            </span><span style="color: #0000FF;">decimal</span><span style="color: #000000;"> workerOfTheMonthBonus </span><span style="color: #000000;">=</span><span style="color: #000000;">
              (Task </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> AwardBonusTask).IsWorkerOfTheMonth </span><span style="color: #000000;">?</span><span style="color: #000000;"> baseSalary </span><span style="color: #000000;">*</span><span style="color: #000000;"> .10m : </span><span style="color: #800080;">0</span><span style="color: #000000;">;
            </span><span style="color: #0000FF;">decimal</span><span style="color: #000000;"> specialServicesBonus </span><span style="color: #000000;">=</span><span style="color: #000000;">
              (Task </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> AwardBonusTask).SpecialServices </span><span style="color: #000000;">?</span><span style="color: #000000;"> baseSalary </span><span style="color: #000000;">*</span><span style="color: #000000;"> .5m : </span><span style="color: #800080;">0</span><span style="color: #000000;">;
            (Task </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> AwardBonusTask).Employee.SetBonusSum(contractsMade </span><span style="color: #000000;">*</span><span style="color: #000000;"> 15000m </span><span style="color: #000000;">+</span><span style="color: #000000;">
                             customersAttracted </span><span style="color: #000000;">*</span><span style="color: #000000;"> 15000m </span><span style="color: #000000;">+</span><span style="color: #000000;"> workerOfTheMonthBonus </span><span style="color: #000000;">+</span><span style="color: #000000;">
                             specialServicesBonus);

            (Task </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> AwardBonusTask).OriginatingTask.OnStart(</span><span style="color: #0000FF;">null</span><span style="color: #000000;">);
        }
    }</span></pre>
    <p>
        Here we do not need to pass anything back to the main task. In more complicated
        situations, however, the originating task's behavior might depend on parameters
        passed back to it by nested tasks.</p>
    <p>
        A few changes should also be made to the MainTask class. The point is that Navigator.NavigateDirectly(...)
        would not activate a view if it is already marked as current for the task. That
        is why calling MainTask.OnStart(...) will have no effect if returning back to the
        main task. Instead, we should use Navigator.ActivateView(...), it will activate
        a view even if it is current for the task.</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> MainTask : TaskBase
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OnStart(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> param)
        {
            <span style="text-decoration:line-through">Navigator.NavigateDirectly(Employees);</span>
            Navigator.ActivateView(Employees);
        }</span></pre>
    <p>
        As we can see tasks communication is done by simply invoking task start methods
        with necessary parameters. For existing task instances we use Task.OnStart(...)
        method, for new tasks TasksManager.StartTask(...) is used.</p>
    <a id="Advanced Options Controller"></a><h3>
        Advanced Options Controller</h3>
    <p>
        This controller simply saves options entered in the advanced options view to the
        task's public fields, and then navigates back to the main award bonus view:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ABAdvancedOptionsController : ControllerBase
    {
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> DoEnterOptions()
        {
            (Task </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> AwardBonusTask).IsWorkerOfTheMonth </span><span style="color: #000000;">=</span><span style="color: #000000;"> (View </span><span style="color: #0000FF;">as</span><span style="color: #000000;">
                                    IABAdvancedOptionsView).IsWorkerOfTheMonth;
            (Task </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> AwardBonusTask).SpecialServices </span><span style="color: #000000;">=</span><span style="color: #000000;"> (View </span><span style="color: #0000FF;">as</span><span style="color: #000000;">
                                    IABAdvancedOptionsView).SpecialServices;
            Task.Navigator.Navigate(AwardBonusTask.MainView);
        }
    }</span></pre>
    <a id="Presentation"></a><h2>
        Presentation</h2>
    <a id="Employees view"></a><h3>
        Employees view</h3>
    <p>
        Views for Silverlight platform should inherit the <code>UserControlView</code> class.
        Therefore firstly we will create an empty <code>UserControlView</code> descendant using the following
        XAML markup:</p>
    <pre><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">mvc:UserControlView </span><span style="color: #FF0000;">xmlns:my</span><span style="color: #0000FF;">=
&quot;clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data&quot;</span><span style="color: #FF0000;">
    x:Class</span><span style="color: #0000FF;">=
&quot;MVCSharp.Examples.TasksInteraction.Presentation.Silverlight.EmployeesView&quot;</span><span style="color: #FF0000;">
    xmlns</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/client/2007&quot;</span><span style="color: #FF0000;">                         
    xmlns:x</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><span style="color: #FF0000;">
    xmlns:mvc</span><span style="color: #0000FF;">=&quot;clr-namespace:MVCSharp.Silverlight;assembly=MVCSharpSL&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;LayoutRoot&quot;</span><span style="color: #FF0000;"> Background</span><span style="color: #0000FF;">=&quot;White&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">mvc:UserControlView</span><span style="color: #0000FF;">&gt;</span></pre>
    <a id="Conclusion"></a><p>
        </p>
    <p>
        Then we should add a data grid to show the list of employees and an "Award Bonus"
        button:</p>
    <p><img src="Images/1.png"/></p>
    <pre><div><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">mvc:UserControlView </span><span style="color: #FF0000;">... </span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;LayoutRoot&quot;</span><span style="color: #FF0000;"> Background</span><span style="color: #0000FF;">=&quot;White&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #FF0000;">.RowDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition </span><span style="color: #FF0000;">Height</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition </span><span style="color: #FF0000;">Height</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid.RowDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #FF0000;">.ColumnDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ColumnDefinition </span><span style="color: #FF0000;">Width</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ColumnDefinition</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid.ColumnDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">my:DataGrid </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;EmployeesGrid&quot;</span><span style="color: #FF0000;"> MinWidth</span><span style="color: #0000FF;">=&quot;200&quot;</span><span style="color: #FF0000;"> MinHeight</span><span style="color: #0000FF;">=&quot;100&quot;</span><span style="color: #FF0000;">
                     Grid.Row</span><span style="color: #0000FF;">=&quot;0&quot;</span><span style="color: #FF0000;"> Grid.Column</span><span style="color: #0000FF;">=&quot;0&quot;</span><span style="color: #FF0000;"> Margin</span><span style="color: #0000FF;">=&quot;5&quot;</span><span style="color: #FF0000;">
                     SelectionMode</span><span style="color: #0000FF;">=&quot;Single&quot;</span><span style="color: #FF0000;"> HorizontalAlignment</span><span style="color: #0000FF;">=&quot;Left&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Button </span><span style="color: #FF0000;">Width</span><span style="color: #0000FF;">=&quot;95&quot;</span><span style="color: #FF0000;"> Height</span><span style="color: #0000FF;">=&quot;25&quot;</span><span style="color: #FF0000;"> HorizontalAlignment</span><span style="color: #0000FF;">=&quot;Right&quot;</span><span style="color: #FF0000;"> Grid.Row</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;">
                Content</span><span style="color: #0000FF;">=&quot;Award Bonus&quot;</span><span style="color: #FF0000;"> Margin</span><span style="color: #0000FF;">=&quot;3&quot;</span><span style="color: #FF0000;"> Click</span><span style="color: #0000FF;">=&quot;AwardBonusButton_Click&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span></pre>
    <p>
        </p>
    <p>
        Note that we are using a layout with two columns so that the view occupies the entire
        window space. Otherwise the contents of underlying views can become visible, which
        is unwanted.</p>
    <p>
        The "Award Bonus" button handler will do nothing but delegate processing to the
        appropriate controller's method. As for the <code>IEmployeesView</code> implementation,
        it is very straightforward as seen from the code below:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EmployeesView : UserControlView, IEmployeesView
    ..
        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> AwardBonusButton_Click(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, RoutedEventArgs e)
        {
            (Controller </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> EmployeesController).AwardBounus();
        }

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> Employee CurrentEmployee
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> EmployeesGrid.SelectedItem </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> Employee; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;"> { EmployeesGrid.SelectedItem </span><span style="color: #000000;">=</span><span style="color: #000000;"> value; }
        }

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> SetEmployeesList(List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Employee</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> employees)
        {
            EmployeesGrid.ItemsSource </span><span style="color: #000000;">=</span><span style="color: #000000;"> employees;
        }</span></pre>
    <p>
        We will also reload the grid's data on the view activation:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EmployeesView : UserControlView, IEmployeesView
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Activate(</span><span style="color: #0000FF;">bool</span><span style="color: #000000;"> activate)
        {
            </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (activate) UpdateEmployeesGrid();
        }

        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> UpdateEmployeesGrid()
        {
            </span><span style="color: #0000FF;">object</span><span style="color: #000000;"> selItm </span><span style="color: #000000;">=</span><span style="color: #000000;"> EmployeesGrid.SelectedItem;
            IEnumerable employees </span><span style="color: #000000;">=</span><span style="color: #000000;"> EmployeesGrid.ItemsSource;
            EmployeesGrid.ItemsSource </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">;
            EmployeesGrid.ItemsSource </span><span style="color: #000000;">=</span><span style="color: #000000;"> employees;
            EmployeesGrid.SelectedItem </span><span style="color: #000000;">=</span><span style="color: #000000;"> selItm;
        }</span></pre>
    <p>
        Last thing required here is to associate the created view class with the "Employees"
        view. We achieve it by applying the <code>[View]</code> attribute to the view class:</p>
    <pre><span style="color: #000000;">    [View(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(MainTask), MainTask.Employees)]
    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> EmployeesView : UserControlView, IEmployeesView
    ...</span></pre>
    <p>
        That is all with the employees view. Next we will design two views for the bonus
        award task.</p>
    <a id="Bonus award views"></a><h3>
        Bonus award views</h3>
    <p>
        First, let us design the award bonus main view. As above, we will start with an
        empty <code>UserControlView</code> descendant:</p>
    <pre><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">mvc:UserControlView </span><span style="color: #FF0000;">xmlns:my</span><span style="color: #0000FF;">=
&quot;clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data&quot;</span><span style="color: #FF0000;">
    x:Class</span><span style="color: #0000FF;">=
&quot;MVCSharp.Examples.TasksInteraction.Presentation.Silverlight.ABMainView&quot;</span><span style="color: #FF0000;">
    xmlns</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/client/2007&quot;</span><span style="color: #FF0000;"> 
    xmlns:x</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><span style="color: #FF0000;"> 
    xmlns:mvc</span><span style="color: #0000FF;">=&quot;clr-namespace:MVCSharp.Silverlight;assembly=MVCSharpSL&quot;</span><span style="color: #FF0000;">
    xmlns:TI</span><span style="color: #0000FF;">=
&quot;clr-namespace:MVCSharp.Examples.TasksInteraction.Presentation.Silverlight&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">mvc:UserControlView</span><span style="color: #0000FF;">&gt;</span></pre>
    <p>
        The view will look as a rounded dialog box on a semi-transparent background:</p>
    <p><img src="Images/2.png"/></p>
    <pre><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">mvc:UserControlView </span><span style="color: #FF0000;">...</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Rectangle </span><span style="color: #FF0000;">HorizontalAlignment</span><span style="color: #0000FF;">=&quot;Stretch&quot;</span><span style="color: #FF0000;"> VerticalAlignment</span><span style="color: #0000FF;">=&quot;Stretch&quot;</span><span style="color: #FF0000;">
                   Opacity</span><span style="color: #0000FF;">=&quot;0.5&quot;</span><span style="color: #FF0000;"> Fill</span><span style="color: #0000FF;">=&quot;Gray&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Border </span><span style="color: #FF0000;">CornerRadius</span><span style="color: #0000FF;">=&quot;30&quot;</span><span style="color: #FF0000;"> Background</span><span style="color: #0000FF;">=&quot;Beige&quot;</span><span style="color: #FF0000;"> Width</span><span style="color: #0000FF;">=&quot;220&quot;</span><span style="color: #FF0000;"> Height</span><span style="color: #0000FF;">=&quot;155&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid </span><span style="color: #FF0000;">Margin</span><span style="color: #0000FF;">=&quot;15, 15, 15, 15&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
                </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid </span><span style="color: #FF0000;">Margin</span><span style="color: #0000FF;">=&quot;2,2,2,0&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #FF0000;">.RowDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
                        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition </span><span style="color: #FF0000;">Height</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition </span><span style="color: #FF0000;">Height</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition </span><span style="color: #FF0000;">Height</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition </span><span style="color: #FF0000;">Height</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid.RowDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #FF0000;">.ColumnDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
                        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ColumnDefinition </span><span style="color: #FF0000;">Width</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ColumnDefinition</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid.ColumnDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">TextBlock </span><span style="color: #FF0000;">Grid.Row</span><span style="color: #0000FF;">=&quot;0&quot;</span><span style="color: #FF0000;"> Text</span><span style="color: #0000FF;">=&quot;Contracts made&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">TextBox </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;ContractsMadeEdit&quot;</span><span style="color: #FF0000;"> Grid.Row</span><span style="color: #0000FF;">=&quot;0&quot;</span><span style="color: #FF0000;"> Width</span><span style="color: #0000FF;">=&quot;30&quot;</span><span style="color: #FF0000;">
                             Grid.Column</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;"> HorizontalAlignment</span><span style="color: #0000FF;">=&quot;Right&quot;</span><span style="color: #FF0000;"> Text</span><span style="color: #0000FF;">=&quot;0&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">TextBlock </span><span style="color: #FF0000;">Grid.Row</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;"> Text</span><span style="color: #0000FF;">=&quot;Customers attracted&quot;</span><span style="color: #FF0000;">
                               VerticalAlignment</span><span style="color: #0000FF;">=&quot;Center&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">TextBox </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;CustAttractedEdit&quot;</span><span style="color: #FF0000;"> Width</span><span style="color: #0000FF;">=&quot;30&quot;</span><span style="color: #FF0000;"> Grid.Row</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;"> 
                             Grid.Column</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;"> HorizontalAlignment</span><span style="color: #0000FF;">=&quot;Right&quot;</span><span style="color: #FF0000;"> Text</span><span style="color: #0000FF;">=&quot;0&quot;</span><span style="color: #FF0000;">
                             Margin</span><span style="color: #0000FF;">=&quot;0,10,0,10&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">HyperlinkButton </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;AdvancedOptionsBtn&quot;</span><span style="color: #FF0000;"> 
                                     Grid.ColumnSpan</span><span style="color: #0000FF;">=&quot;2&quot;</span><span style="color: #FF0000;"> Content</span><span style="color: #0000FF;">=&quot;Advanced Options&quot;</span><span style="color: #FF0000;">
                                     Grid.Row</span><span style="color: #0000FF;">=&quot;2&quot;</span><span style="color: #FF0000;"> Click</span><span style="color: #0000FF;">=&quot;AdvancedOptsBtn_Click&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Button </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;OkBtn&quot;</span><span style="color: #FF0000;"> Grid.Row</span><span style="color: #0000FF;">=&quot;3&quot;</span><span style="color: #FF0000;"> Grid.Column</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;">
                            Content</span><span style="color: #0000FF;">=&quot;OK&quot;</span><span style="color: #FF0000;"> Click</span><span style="color: #0000FF;">=&quot;OkBtn_Click&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
                </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
                </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">TI:ABAdvancedOptionsView </span><span style="color: #FF0000;">ViewName</span><span style="color: #0000FF;">=&quot;Advanced Options View&quot;</span><span style="color: #FF0000;">
                                          Visibility</span><span style="color: #0000FF;">=&quot;Collapsed&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Border</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">mvc:UserControlView</span><span style="color: #0000FF;">&gt;</span></pre>
    <p>
        The advanced options view will be shown inside the award bonus main view, in the
        rounded dialog box. That is why the markup above contains the &lt;TI:ABAdvancedOptionsView
        ...&gt; element. It should be hidden at first (Visibility="Collapsed") and its name
        should be specified (ViewName="Advanced Options View") for the framework to properly
        identify it.</p>
    <p>
        Below is the advanced options view markup:</p>
    <p><img src="Images/3.png"/></p>
    <pre><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">mvc:UserControlView </span><span style="color: #FF0000;">xmlns:my</span><span style="color: #0000FF;">=
&quot;clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data&quot;</span><span style="color: #FF0000;">
    x:Class</span><span style="color: #0000FF;">=
&quot;MVCSharp.Examples.TasksInteraction.Presentation.Silverlight.ABAdvancedOptionsView&quot;</span><span style="color: #FF0000;">
    xmlns</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/client/2007&quot;</span><span style="color: #FF0000;"> 
    xmlns:x</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><span style="color: #FF0000;"> 
    xmlns:mvc</span><span style="color: #0000FF;">=&quot;clr-namespace:MVCSharp.Silverlight;assembly=MVCSharpSL&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid </span><span style="color: #FF0000;">Background</span><span style="color: #0000FF;">=&quot;Beige&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #FF0000;">.RowDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">RowDefinition</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid.RowDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Grid</span><span style="color: #FF0000;">.ColumnDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ColumnDefinition </span><span style="color: #FF0000;">Width</span><span style="color: #0000FF;">=&quot;Auto&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
            </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ColumnDefinition</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid.ColumnDefinitions</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">CheckBox </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;WorkerOfTheMonthCB&quot;</span><span style="color: #FF0000;"> Grid.Row</span><span style="color: #0000FF;">=&quot;0&quot;</span><span style="color: #FF0000;">
                  Content</span><span style="color: #0000FF;">=&quot;Worker Of The Month&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">CheckBox </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;SpecialServicesCB&quot;</span><span style="color: #FF0000;"> Grid.Row</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;">
                  Content</span><span style="color: #0000FF;">=&quot;Special Services&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Button </span><span style="color: #FF0000;">Grid.Row</span><span style="color: #0000FF;">=&quot;2&quot;</span><span style="color: #FF0000;"> Width</span><span style="color: #0000FF;">=&quot;50&quot;</span><span style="color: #FF0000;"> Margin</span><span style="color: #0000FF;">=&quot;0,10,0,0&quot;</span><span style="color: #FF0000;"> Grid.Column</span><span style="color: #0000FF;">=&quot;1&quot;</span><span style="color: #FF0000;">
                Content</span><span style="color: #0000FF;">=&quot;OK&quot;</span><span style="color: #FF0000;"> Click</span><span style="color: #0000FF;">=&quot;OkBtn_Click&quot;</span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;">
    </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">Grid</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;">
</span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">mvc:UserControlView</span><span style="color: #0000FF;">&gt;</span></pre>
    <p>
        Now let us turn attention to the views' code-behind files. The award bouns main
        view class should implement the <code>IABMainView</code> interface and should handle the "Advanced Options"
        link and the "OK" button clicks. As before, we also use the <code>[View]</code> attribute for
        registrating the view:</p>
    <pre><span style="color: #000000;">    [View(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(AwardBonusTask), AwardBonusTask.MainView)]
    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ABMainView : UserControlView, IABMainView
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">int</span><span style="color: #000000;"> ContractsMade
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> Convert.ToInt32(ContractsMadeEdit.Text); }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;"> { ContractsMadeEdit.Text </span><span style="color: #000000;">=</span><span style="color: #000000;"> value.ToString(); }
        }

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">int</span><span style="color: #000000;"> CustomersAttracted
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> Convert.ToInt32(CustAttractedEdit.Text); }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;"> { CustAttractedEdit.Text </span><span style="color: #000000;">=</span><span style="color: #000000;"> value.ToString(); }
        }

        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OkBtn_Click(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, RoutedEventArgs e)
        {
            (Controller </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> ABMainController).DoAwardBonus();
        }

        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> AdvancedOptsBtn_Click(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, RoutedEventArgs e)
        {
            (Controller </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> ABMainController).ShowAdvancedOptions();
        }</span></pre>
    <p>
        The advanced options view class should implement the <code>IABAdvancedOptionsView</code> interface
        and should handle the "OK" button click. Moreover it should hide itself each time it is
        deactivated to reveal the parent view controls. Since we have explicitly placed
        this view inside the award bonus main view (see the XAML of the award bonus main
        view above), the <code>[View]</code> attribute is not required here:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ABAdvancedOptionsView : UserControlView, IABAdvancedOptionsView
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Activate(</span><span style="color: #0000FF;">bool</span><span style="color: #000000;"> activate)
        {
            </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (</span><span style="color: #000000;">!</span><span style="color: #000000;">activate) Visibility </span><span style="color: #000000;">=</span><span style="color: #000000;"> Visibility.Collapsed;
        }

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">bool</span><span style="color: #000000;"> IsWorkerOfTheMonth
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> (</span><span style="color: #0000FF;">bool</span><span style="color: #000000;">)WorkerOfTheMonthCB.IsChecked; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;"> { WorkerOfTheMonthCB.IsChecked </span><span style="color: #000000;">=</span><span style="color: #000000;"> value; }
        }

        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">bool</span><span style="color: #000000;"> SpecialServices
        {
            </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> (</span><span style="color: #0000FF;">bool</span><span style="color: #000000;">)SpecialServicesCB.IsChecked; }
            </span><span style="color: #0000FF;">set</span><span style="color: #000000;"> { SpecialServicesCB.IsChecked </span><span style="color: #000000;">=</span><span style="color: #000000;"> value; }
        }

        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OkBtn_Click(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, RoutedEventArgs e)
        {
            (Controller </span><span style="color: #0000FF;">as</span><span style="color: #000000;"> ABAdvancedOptionsController).DoEnterOptions();
        }</span></pre>
    <p>
        Finally, we should write the application startup method. Inside it the main task
        should be started, obviously:</p>
    <pre><span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> App : Application
    ...
        </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> App()
        {
            </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.Startup </span><span style="color: #000000;">+=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.Application_Startup;
            InitializeComponent();
        }

        </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Application_Startup(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, StartupEventArgs e)
        {
            TasksManager tasksManager </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> TasksManager(SilverlightViewsManager.
                                                         GetDefaultConfig());
            tasksManager.StartTask(</span><span style="color: #0000FF;">typeof</span><span style="color: #000000;">(MainTask));
        }</span></pre>
    <h2>
        Conclusion</h2>
    <p>
        Tasks interaction in MVC# is no harder than an ordinary interaction between two
        objects: one tasks just passes needed data to the other task's OnStart(...) method
        (either directly or by calling TasksManager.StartTask(...) if the task instance
        does not exist yet). Using MVC# with Silverlight platform is easy as well: everything
        needed is to design view classes, just like for other presentation platforms (Windows
        and ASP.NET forms).</p>
    <p>
        <em>The source code of this example can be found under "Examples\TasksInteraction\" subfolder
            of the MVC# root folder. Silverlight presentation project is in the "Examples\TasksInteraction\Presentation\Silverlight"
            folder. The framework itself can be downloaded from <a
                href="http://www.mvcsharp.org/Download.aspx">www.MVCSharp.org/download.aspx</a>.</em></p>        

                </div>
            </div>
        </div>
        <div style="text-align:center; font-size:11px;">Copyright  www.MVCSharp.org</div>
    </form>
</body>

<!-- Mirrored from mvcsharp.org/Tasks_Interaction/Default.aspx by HTTrack Website Copier/3.x [XR&CO'2008], Thu, 30 Oct 2008 03:46:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>
